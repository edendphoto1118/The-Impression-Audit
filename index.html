<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDEN | Visual Audit</title>
    <script src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:ital,opsz,wght@0,6..96,400;0,6..96,700;1,6..96,400&family=Montserrat:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg: #000000;
            --text: #ffffff;
            --accent: #E5E5E5; /* 鉑金白 */
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden; /* 禁止滾動，保持全屏 */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 雜誌封面容器 (9:16 比例) */
        .magazine-cover {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 500px; /* 手機寬度限制 */
            max-height: 900px;
            background: #111;
            overflow: hidden;
            box-shadow: 0 0 40px rgba(0,0,0,0.8);
        }

        /* 背景圖片層 */
        .bg-image {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover;
            filter: grayscale(100%) contrast(110%) brightness(0.9); /* 黑白高質感 */
            z-index: 1;
            transition: filter 0.5s ease;
        }

        /* 時尚遮罩層 */
        .overlay-gradient {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, 
                rgba(0,0,0,0.3) 0%, 
                rgba(0,0,0,0) 40%, 
                rgba(0,0,0,0.6) 70%, 
                rgba(0,0,0,0.95) 100%);
            z-index: 2;
        }

        /* 上傳按鈕 (隱藏式) */
        .upload-trigger {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 20px 40px;
            text-align: center;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: 0.3s;
        }
        .upload-trigger:hover { background: rgba(255,255,255,0.1); border-color: #fff; }
        .upload-text { font-family: 'Bodoni Moda', serif; font-size: 1.2rem; letter-spacing: 2px; }
        input[type="file"] { display: none; }

        /* 內容層 */
        .content-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 5;
            padding: 30px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            pointer-events: none; /* 讓點擊穿透到上傳按鈕 */
            opacity: 0; /* 初始隱藏 */
            transition: opacity 1s ease;
        }

        /* 頂部品牌標示 */
        .top-bar {
            display: flex;
            justify-content: space-between;
            border-top: 1px solid rgba(255,255,255,0.3);
            padding-top: 15px;
            font-size: 0.6rem;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        /* 核心結論區 (底部) */
        .bottom-panel {
            text-align: center;
        }

        /* 巨大的 VOGUE 風格標題 */
        .archetype-title {
            font-family: 'Bodoni Moda', serif;
            font-size: 3.5rem;
            line-height: 1;
            font-style: italic;
            margin-bottom: 10px;
            text-shadow: 0 10px 30px rgba(0,0,0,0.8);
        }

        .archetype-subtitle {
            font-size: 0.8rem;
            letter-spacing: 4px;
            text-transform: uppercase;
            margin-bottom: 30px;
            font-weight: 300;
            color: rgba(255,255,255,0.8);
        }

        /* 關鍵字標籤 */
        .keywords {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }
        .tag {
            border: 1px solid rgba(255,255,255,0.4);
            padding: 5px 12px;
            font-size: 0.6rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            border-radius: 50px; /* 膠囊狀 */
        }

        /* 極簡光譜條 */
        .spectrum-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding: 0 10px;
        }
        .spectrum-label { font-size: 0.6rem; color: #888; letter-spacing: 1px; width: 60px; }
        .bar-bg {
            flex-grow: 1;
            height: 1px;
            background: rgba(255,255,255,0.3);
            margin: 0 15px;
            position: relative;
        }
        .bar-point {
            position: absolute;
            top: 50%;
            width: 8px; height: 8px;
            background: #fff;
            transform: translate(-50%, -50%) rotate(45deg); /* 菱形點 */
            box-shadow: 0 0 10px #fff;
        }

        /* 診斷短句 */
        .diagnosis-line {
            font-family: 'Bodoni Moda', serif;
            font-size: 1rem;
            line-height: 1.4;
            margin-top: 20px;
            color: #ddd;
            font-style: italic;
        }

        /* CTA 按鈕 (做成像是雜誌頁碼或連結) */
        .cta-link {
            margin-top: 30px;
            font-size: 0.7rem;
            letter-spacing: 2px;
            border-bottom: 1px solid #fff;
            display: inline-block;
            padding-bottom: 5px;
            pointer-events: auto; /* 允許點擊 */
            cursor: pointer;
            text-decoration: none;
            color: white;
        }

        /* 載入動畫 */
        .scanner-line {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 2px;
            background: #fff;
            box-shadow: 0 0 15px #fff;
            z-index: 20;
            display: none;
            animation: scan 1.5s infinite ease-in-out;
        }
        @keyframes scan { 0% {top:0} 50% {top:100%} 100% {top:0} }

    </style>
</head>
<body>

    <div class="magazine-cover" id="cover">
        <div class="scanner-line" id="scanner"></div>
        <div class="overlay-gradient"></div>
        <img id="bgImage" class="bg-image" src="" style="display:none;" />

        <div class="upload-trigger" id="uploadBtn" onclick="document.getElementById('fileInput').click()">
            <div class="upload-text">UPLOAD PORTRAIT</div>
            <div style="font-size: 0.6rem; margin-top: 8px; color: #888;">EDEN VISUAL LAB</div>
        </div>
        <input type="file" id="fileInput" accept="image/*">

        <div class="content-layer" id="resultLayer">
            <div class="top-bar">
                <span>ISSUE.2026</span>
                <span>IMPRESSION AUDIT</span>
                <span>VOL.01</span>
            </div>

            <div class="bottom-panel">
                
                <div class="archetype-title" id="archTitle">--</div>
                <div class="archetype-subtitle" id="archSub">AESTHETIC IDENTITY</div>

                <div class="keywords" id="keywordBox">
                    </div>

                <div class="spectrum-container">
                    <span class="spectrum-label" style="text-align: right;">ICE</span>
                    <div class="bar-bg"><div class="bar-point" id="pointWarmth" style="left: 50%;"></div></div>
                    <span class="spectrum-label" style="text-align: left;">FIRE</span>
                </div>

                <div class="spectrum-container">
                    <span class="spectrum-label" style="text-align: right;">SOFT</span>
                    <div class="bar-bg"><div class="bar-point" id="pointComp" style="left: 50%;"></div></div>
                    <span class="spectrum-label" style="text-align: left;">HARD</span>
                </div>

                <div class="diagnosis-line" id="quoteText">
                    "Analyzing facial structure..."
                </div>

                <a href="https://instagram.com/eden_d_photo" target="_blank" class="cta-link">
                    BOOK A RE-STRUCTURE SESSION
                </a>
            </div>
        </div>
    </div>

    <script>
        // 初始化
        const fileInput = document.getElementById('fileInput');
        const bgImage = document.getElementById('bgImage');
        const uploadBtn = document.getElementById('uploadBtn');
        const scanner = document.getElementById('scanner');
        const resultLayer = document.getElementById('resultLayer');
        let modelsLoaded = false;

        // 載入模型
        Promise.all([
            faceapi.nets.tinyFaceDetector.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models'),
            faceapi.nets.faceLandmark68Net.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models'),
            faceapi.nets.faceExpressionNet.loadFromUri('https://justadudewhohacks.github.io/face-api.js/models')
        ]).then(() => {
            modelsLoaded = true;
            console.log('AI Ready');
        });

        // 上傳處理
        fileInput.addEventListener('change', async () => {
            if (!modelsLoaded) return alert('AI 正在暖機，請稍等 3 秒...');
            const file = fileInput.files[0];
            if (!file) return;

            // UI 狀態更新
            uploadBtn.style.display = 'none';
            scanner.style.display = 'block';
            
            const reader = new FileReader();
            reader.onload = (e) => {
                bgImage.src = e.target.result;
                bgImage.style.display = 'block';
                
                bgImage.onload = async () => {
                    await analyzeFace();
                }
            }
            reader.readAsDataURL(file);
        });

        // 分析邏輯
        async function analyzeFace() {
            // 延遲模擬運算感
            setTimeout(async () => {
                const detection = await faceapi.detectSingleFace(bgImage, new faceapi.TinyFaceDetectorOptions())
                    .withFaceLandmarks()
                    .withFaceExpressions();

                scanner.style.display = 'none';
                
                if (!detection) {
                    alert('未偵測到臉部，請使用正面清晰照。');
                    window.location.reload();
                    return;
                }

                // 計算數值
                const exp = detection.expressions;
                let warmth = 30 + (exp.happy * 80) + (exp.surprised * 20) - (exp.angry * 30);
                let competence = 40 + (exp.neutral * 60) + (exp.angry * 20) - (exp.happy * 30);
                
                // 限制範圍 0-100
                warmth = Math.min(100, Math.max(0, warmth));
                competence = Math.min(100, Math.max(0, competence));

                renderResult(warmth, competence);

            }, 1000);
        }

        // 渲染結果 (VOGUE Style)
        function renderResult(w, c) {
            resultLayer.style.opacity = 1;

            // 1. 設定光譜點位置
            document.getElementById('pointWarmth').style.left = `${w}%`;
            document.getElementById('pointComp').style.left = `${c}%`;

            // 2. 定義人格原型 (MBTI for Aesthetics)
            let title = "";
            let sub = "";
            let tags = [];
            let quote = "";

            if (c > 70 && w < 40) {
                title = "The Minimalist"; // 極簡主義者
                sub = "COLD ARCHITECTURE";
                tags = ["#CleanLine", "#Distance", "#HighEnd"];
                quote = "你的面部結構極度冷靜，像一座未經裝飾的清水模建築。高級，但生人勿近。";
            } 
            else if (w > 70 && c < 50) {
                title = "The Rococo"; // 洛可可
                sub = "DECORATIVE SOUL";
                tags = ["#Warmth", "#Chaos", "#Approachable"];
                quote = "充滿了洛可可式的繁複情感曲線。親和力過剩，反而模糊了專業結構的邊界。";
            }
            else if (w > 60 && c > 60) {
                title = "The Golden Ratio"; // 黃金比例
                sub = "BALANCED FORM";
                tags = ["#Alpha", "#Structure", "#Magnetic"];
                quote = "你是極少數同時擁有結構張力與視覺溫度的存在。這是一張為封面而生的臉。";
            }
            else if (c < 40 && w < 40) {
                title = "The Noir"; // 黑色電影
                sub = "UNDEFINED SHADOW";
                tags = ["#Mystery", "#Blur", "#Raw"];
                quote = "訊號微弱。你的光影結構尚未定義，像是一張顯影不足的底片。需要重塑。";
            }
            else {
                title = "The Brutalist"; // 粗野主義
                sub = "RAW MATERIAL";
                tags = ["#Honest", "#Direct", "#Force"];
                quote = "直白、強烈，沒有多餘的情緒修飾。你的存在本身就是一種結構性的聲明。";
            }

            // 3. 填入內容
            document.getElementById('archTitle').innerText = title;
            document.getElementById('archSub').innerText = sub;
            document.getElementById('quoteText').innerText = quote;
            
            const tagBox = document.getElementById('keywordBox');
            tagBox.innerHTML = tags.map(t => `<span class="tag">${t}</span>`).join('');
        }
    </script>
</body>
</html>
